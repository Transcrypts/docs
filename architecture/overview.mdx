---
title: "Architecture Overview"
description: "System design, package structure, and communication model"
---

## Overview

Transcrypts is an employment verification platform delivered as an embeddable SDK. The system uses an **iframe-based architecture** to provide a secure, isolated verification experience within any client application.

The design follows a strict separation of concerns:

- **SDK** (`transcrypts`) -- A lightweight (~5KB) vanilla TypeScript library that client applications import. It manages lifecycle, iframe creation, and cross-origin communication.
- **Widget** (`@transcrypts/widget`) -- A React single-page application hosted on a separate origin. It renders the verification UI, handles sensitive data, and communicates with the Transcrypts backend API.

This separation ensures that sensitive data (SSNs, employment records) never enters the client application's DOM or JavaScript context. All communication between the SDK and the widget occurs exclusively through the browser's `window.postMessage` API with origin validation.

## System Architecture

```
+------------------------------------------------------------------+
|                        Client Application                        |
|                                                                  |
|  +------------------------------------------------------------+ |
|  |                      Transcrypts SDK                        | |
|  |                    (~5KB, vanilla TS)                        | |
|  |                                                              | |
|  |  +------------------+  +------------------+  +------------+ | |
|  |  | Transcrypts      |  | Iframe Manager   |  | Event      | | |
|  |  | Class            |  | (iframe.ts)      |  | System     | | |
|  |  | - verify()       |  | - mount()        |  | - on()     | | |
|  |  | - on()           |  | - destroy()      |  | - emit()   | | |
|  |  | - createToken()  |  | - overlay/styles |  |            | | |
|  |  | - validateOrigin |  |                  |  |            | | |
|  |  +------------------+  +------------------+  +------------+ | |
|  +------------------------------------------------------------+ |
|                              |                                   |
+------------------------------------------------------------------+
                               | window.postMessage
                               | (origin-validated)
                               |
+------------------------------------------------------------------+
|                  Iframe (separate browsing context)               |
|                  Origin: widget.transcrypts.com                   |
|                                                                  |
|  +------------------------------------------------------------+ |
|  |                   Transcrypts Widget                         | |
|  |                  (React 19 SPA)                              | |
|  |                                                              | |
|  |  +------------------+  +------------------+  +------------+ | |
|  |  | Token Parser     |  | Verification UI  |  | postMessage| | |
|  |  | (base64 decode)  |  | - Profile Card   |  | Bridge     | | |
|  |  | - parseToken()   |  | - Work History   |  | - notify() | | |
|  |  | - maskSSN()      |  | - Options Modal  |  | - events   | | |
|  |  +------------------+  +------------------+  +------------+ | |
|  +------------------------------------------------------------+ |
|                              |                                   |
+------------------------------------------------------------------+
                               | HTTPS
                               |
+------------------------------------------------------------------+
|                     Transcrypts Backend API                       |
|                                                                  |
|  +------------------+  +------------------+  +----------------+ |
|  | Auth & API Key   |  | Employment       |  | Verification   | |
|  | Validation       |  | Data Retrieval   |  | Processing     | |
|  +------------------+  +------------------+  +----------------+ |
|                              |                                   |
+------------------------------------------------------------------+
                               |
+------------------------------------------------------------------+
|                        Data Sources                               |
|                                                                  |
|  +------------+  +-----------+  +----------+  +--------------+  |
|  | SSA Records|  | Payroll   |  | Banking  |  | Document     |  |
|  |            |  | Providers |  | APIs     |  | Verification |  |
|  +------------+  +-----------+  +----------+  +--------------+  |
+------------------------------------------------------------------+
```

### Data Flow Summary

```
1. Client App         -->  SDK.verify({ ssn })      Create session token
2. SDK                -->  Iframe Manager            Mount iframe overlay
3. Iframe Manager     -->  Widget URL + token        Load widget in iframe
4. Widget             -->  parseToken(token)         Decode and validate session
5. Widget             -->  postMessage("ready")      Notify SDK widget is ready
6. Widget             -->  Backend API               Fetch employment records
7. Widget             -->  postMessage("loaded")     Notify SDK data loaded
8. User interacts     -->  Widget UI                 Select verification methods
9. Widget             -->  Backend API               Execute verification
10. Widget            -->  postMessage("complete")   Return results to SDK
11. SDK               -->  Client App                Resolve verify() promise
12. Iframe Manager    -->  DOM cleanup               Remove overlay and iframe
```

## Package Structure

```
transcrypts-sdk/
|
+-- package.json                      Root workspace configuration
+-- pnpm-workspace.yaml              Workspace package definitions
+-- pnpm-lock.yaml                   Lockfile for deterministic installs
|
+-- packages/
|   |
|   +-- sdk/                          Published npm package: "transcrypts"
|   |   +-- package.json              v0.1.0, MIT license, ESM + CJS exports
|   |   +-- tsup.config.ts            Build config: ESM, CJS, IIFE, DTS
|   |   +-- src/
|   |       +-- index.ts              Public API surface (re-exports)
|   |       +-- Transcrypts.ts        Core SDK class: verify(), on(), event system
|   |       +-- iframe.ts             Iframe lifecycle: mount, destroy, overlay
|   |       +-- types.ts              All TypeScript interfaces and type aliases
|   |
|   +-- widget/                       Private package: "@transcrypts/widget"
|       +-- package.json              React 19, Vite 6, Tailwind CSS 4
|       +-- vite.config.ts            Dev server (port 3001), path aliases
|       +-- src/
|           +-- main.tsx              React root mount point
|           +-- App.tsx               Token parsing, error/loading states, postMessage bridge
|           +-- utils/
|           |   +-- token.ts          parseToken (base64), maskSSN utility
|           +-- lib/
|           |   +-- utils.ts          cn() helper (clsx + tailwind-merge)
|           +-- components/
|           |   +-- VerificationWidget.tsx       Main UI: profile, jobs, progress
|           |   +-- WorkExperienceCard.tsx       Individual employment record card
|           |   +-- VerificationOptionsModal.tsx Method picker (SSA, payroll, banking, upload)
|           |   +-- CredentialBanner.tsx         Current employer credential prompt
|           |   +-- ui/                          Shared primitives (badge, button, card, dialog)
|           +-- styles/
|               +-- index.css         Global styles, Tailwind directives
|
+-- api-docs/                         Documentation (this directory)
```

### Package Responsibilities

| Package | npm Name | Published | Purpose |
|---------|----------|-----------|---------|
| `packages/sdk` | `transcrypts` | Yes (npm) | Client-side SDK. Creates iframe, manages postMessage, exposes `verify()` and event API. |
| `packages/widget` | `@transcrypts/widget` | No (private) | Verification UI. Renders inside iframe, handles sensitive data, communicates with backend. |

## Communication Model

All communication between the client application (via the SDK) and the verification widget occurs through the browser's `window.postMessage` API. There is no direct DOM access, no shared memory, and no function calls between the two contexts.

### Message Direction

```
Client App / SDK                          Widget (iframe)
     |                                         |
     |  --- postMessage (close) ------------>  |
     |                                         |
     |  <-- postMessage (ready) ------------   |
     |  <-- postMessage (loaded) -----------   |
     |  <-- postMessage (verification_*)  --   |
     |  <-- postMessage (close) ------------   |
```

**Widget to SDK (upstream):** The widget sends structured event messages to the parent window using `window.parent.postMessage()`.

**SDK to Widget (downstream):** Currently limited to the `close` event dispatched via `window.postMessage()` on backdrop click.

### Message Format

All messages conform to the `TranscryptsEvent` interface:

```typescript
interface TranscryptsEvent {
  type: TranscryptsEventType;
  payload?: Record<string, unknown>;
}
```

### Event Types

| Event Type | Direction | Description |
|------------|-----------|-------------|
| `ready` | Widget --> SDK | Widget has mounted and parsed the session token |
| `loaded` | Widget --> SDK | Employment data has been fetched and rendered |
| `verification_started` | Widget --> SDK | User has initiated a verification flow |
| `verification_complete` | Widget --> SDK | Verification succeeded; payload contains results |
| `verification_failed` | Widget --> SDK | Verification failed; payload contains error details |
| `close` | Bidirectional | User or SDK requested the widget to close |

### Origin Validation

The SDK validates every incoming `postMessage` event against the configured widget origin:

```typescript
private isValidOrigin(origin: string): boolean {
  try {
    const widgetOrigin = new URL(this.widgetUrl).origin;
    return origin === widgetOrigin;
  } catch {
    return false;
  }
}
```

Messages from any origin other than the widget's configured origin are silently discarded. This prevents cross-origin injection attacks where a malicious page or frame attempts to send spoofed events to the SDK.

### Notification Function (Widget Side)

The widget sends messages to the parent frame through the `notifyParent` helper:

```typescript
export function notifyParent(type: string, payload: Record<string, unknown>) {
  if (window.parent !== window) {
    window.parent.postMessage({ type, payload }, '*');
  }
}
```

The `window.parent !== window` guard ensures the function is a no-op when the widget is loaded outside an iframe context (e.g., during standalone development).
